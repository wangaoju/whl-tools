# 消消乐小程序（微信小游戏）产品与技术规划 v1.0

作者：产品/技术联合草案
目标平台：微信小游戏（可同步支持字节、QQ 等平台）
目标周期：MVP 4 周 + 运营迭代 4 周

—

## 1. 产品定位与目标
- 类型：轻度三消（Match-3），面向全年龄段，碎片化时间（30 秒–3 分钟/局）。
- 风格：清新卡通，色彩鲜明，动效顺滑，低认知负担，高爽感。
- 目标：
  - D1 留存≥35%，7 日留存≥8%。
  - 首月关卡量≥150 关，长期迭代至 1000+ 关。
  - 广告+内购混合变现，ARPDAU ≥ 0.07–0.12。

## 2. 核心循环（Core Loop）
1) 进入关卡 → 2) 交换临近棋子达成 3 个及以上消除 → 3) 连锁掉落+生成特殊棋子 → 4) 完成关卡目标（在步数/时间限制内） → 5) 结算奖励/推进地图 → 6) 资源消耗（体力/生命）与补充（广告/内购/社交） → 7) 解锁下一关/日常任务/活动。

## 3. 关卡与目标类型
- 常规目标：
  - 收集类：消除/掉落指定颜色数量（如收集 60 个蓝色）。
  - 清除类：清除果冻/冰层/藤蔓/蜂蜡等覆盖物。
  - 掉落类：将“樱桃/坚果/玩偶”等目标物掉落到底部，数量有要求。
  - 打破障碍：巧克力（会增长）、锁链、石块、笼子、木箱、多层蛋糕等。
- 限制条件：
  - 步数限制（主流）；部分关卡采用时间限制（快节奏副玩法）。
- 关卡评价：1–3 星，根据剩余步数/时间、过关效率等计算。

## 4. 棋盘元素与机制（精选）
- 基础棋子：5–6 种颜色，初期 5 种，随章节增加至 6 种提升难度。
- 特殊棋子（与主流一致）：
  - 条纹糖（4 连）：所在行/列清屏；方向由形成方向决定。
  - 包装糖（L/T 形 5 消）：爆炸两次，范围 3×3。
  - 彩色炸弹（5 连）：与任意颜色交换，清屏同色；与特殊棋子结合产生大范围效果。
- 特殊组合：
  - 条纹+条纹：双行/双列清除。
  - 条纹+包装：十字大爆炸（扩大范围）。
  - 包装+包装：更大范围的二次爆炸。
  - 彩色炸弹+条纹：将某色全部转为条纹并触发。
  - 彩色炸弹+包装：将某色全部转为包装并触发。
  - 彩色炸弹+彩色炸弹：全屏双重清除。
- 常见障碍：
  - 冰层/果冻（1–3 层）、蜂蜡/泡沫（阻挡）、锁链（需邻消解锁）。
  - 巧克力（每回合增长，需压制），甘草/煤球（阻挡下落）。
  - 传送带/传送门（改变路径）、气泡/气球（需连续命中）。
- 机关：定时炸弹、颜色变换器、下落限定口、单向门等，逐章节引入。

## 5. 道具与消耗品（Boosters & Consumables）
- 关卡内道具（入场带入/局内获得）：
  - 小锤子（消除任意单格）、换位手套（不消也能交换一次）。
  - 加步道具（+5 步）、彩色刷子（将一格变为指定颜色）。
- 关卡外道具（入场 Buff）：
  - 开局条纹/包装/彩色炸弹、双开局（两种随机生成）。
- 获取途径：
  - 新手任务、日常任务、活动、广告激励、内购礼包、闯关星星商店。

## 6. 经济系统（Economy）
- 货币：
  - 软币（Coins）：通关奖励、任务、广告获得；用于购买入场道具、复活。
  - 硬通货（钻石/星券）：内购为主；可兑换软币、购买体力、复活、大礼包。
- 体力/生命：
  - 5 点上限，自然恢复；失败-1，胜利不扣；广告/内购/好友赠送补充。
- 商店：
  - 新手 1 元/3 元/6 元首充礼包、日常 6 元补给包、节日主题包。

## 7. 进度系统与地图
- 世界地图分章节（每章 20–30 关），主题皮肤更替，解锁新机制。
- 星星宝箱：累计星星开箱；每 24–72 小时重置一次。
- 赛季通行证（可选第二期上线）：
  - 免费/高级两条奖励轨道，依据赛季积分（过关、任务、活动）。

## 8. 活动与运营
- 日常：
  - 每日登录、每日任务（消除 X 次、清除巧克力 X 个等）。
  - 爬塔/抢星活动（限时 48–72 小时），排行榜发放道具/硬通货。
- 周期性：
  - 限时主题关、皮肤返场、拼图收集、累充/累看广告奖励。
- A/B 测试：
  - 新手 10 关难度、广告频率、复活价格、关卡掉落权重。

## 9. 社交与分享（微信）
- 好友榜（开放数据域）：显示当前章节星数、最新闯关进度。
- 体力互赠、复活求助（分享卡片）；分享回流带激励。
- 群排行/活动排行；节假日红包雨（广告+分享混合引流）。

## 10. 技术方案（小游戏端）
- 引擎建议：
  - Cocos Creator 3.x（2D 项目，成熟生态，导出微信小游戏便捷）。
  - 备选：LayaAir、Egret；或自研 Canvas/WebGL，但动效&工具链成本更高。
- 架构原则：逻辑与渲染解耦，网格引擎（棋盘）独立、可单元测试、可复盘。
  - Core（纯逻辑）：Board、Cell、Tile、MatchFinder、Resolver、Spawner、RNG、GoalChecker、LevelLoader。
  - Game（业务）：Booster、Inventory、Energy、Economy、Ads、IAP、Analytics。
  - View（渲染）：GridView、TileView、VFX、SFX、UIFlow（HUD、弹窗、地图）。
- 关键技术点：
  - 可解性：生成初始局面时确保至少存在 1 步；无解则重新洗牌（Shuffle）。
  - 随机一致性：使用种子 RNG（如 xorshift/seedrandom），便于复盘与 A/B 对照。
  - 关卡序列化：JSON 配置；支持分包与远程热更新配置。
  - 性能：目标 60 FPS；对象池、合图、骨骼/粒子数量上限控制；低端机降级动效。
  - 包体：控制主包体积，资源分包与首包关键资源预载；二次资源 CDN。
  - 数据：
    - 基础埋点：关卡进入/失败/胜利、步数分布、复活点击、广告点击、IAP 转化。
    - 归因：渠道参数（分享、活动），上报频率与断网补发策略。
- 微信侧集成：
  - 激励视频/插屏广告、登录与用户授权、开放数据域排行、分享卡片。
  - 审核规范：敏感文案、诱导分享、广告频次与位置合规。

### 10.1 关卡 JSON 示例
```json
{
  "id": 12,
  "name": "冰原-12",
  "board": { "rows": 9, "cols": 9,
    "holes": [[0,0],[0,8]],
    "spawn": { "top": true }
  },
  "colors": 5,
  "goals": [
    { "type": "clear_layer", "target": "jelly", "count": 35 },
    { "type": "collect", "target": "blue", "count": 50 }
  ],
  "limits": { "moves": 25 },
  "obstacles": [
    { "type": "jelly", "layer": 2, "areas": [[2,2,6,6]] },
    { "type": "chocolate", "spawnRate": 1, "areas": [[4,4,4,4]] }
  ],
  "initial": [
    // 可留空表示由 Spawner 随机生成（受 seed 影响）。
  ],
  "spawnRules": {
    "colorWeights": { "r":1, "g":1, "b":1, "y":1, "p":1 },
    "banPatterns": ["no_match_on_spawn"]
  },
  "recommendedBoosters": ["hammer", "extra_moves"],
  "seed": 123456
}
```

## 11. UI/UX 关键点
- 棋盘尺寸：建议 9×9（中后期）/ 8×8（早期），适配全面屏；手指接触面积≥48 dp。
- 动效节奏：消除间隔 200–300ms，连锁加速；关键反馈加震动/音效。
- 引导：前 10 关分步引导特殊棋子与组合，失败时给予“推荐道具”。
- 辅助：可开闭提示（3 秒无操作高亮一处可消点），色盲友好配色包。

## 12. 美术与音频
- 统一卡通风格，章节主题（森林、沙滩、雪原、糖果厂等）。
- 资源合图，PNG8/WEBP 优先，音频采样与码率控制，BGM 3–4 条循环。

## 13. QA 与发布
- 自动化：核心棋盘引擎单测（匹配、掉落、洗牌、可解性）；性能压测脚本。
- 人测：难度曲线、10–30–60 秒爽感、失败点与复活点位合理性。
- 发布：体验版→小范围白名单→全量；灰度 A/B 配置下发与回滚预案。

## 14. 里程碑规划（建议）
- 第 1 周：
  - 棋盘引擎原型（交换/匹配/掉落/连锁/洗牌/可解性）。
  - 基础 UI（关卡页、HUD、结算弹窗），2–3 种障碍，3 种特殊棋子。
- 第 2 周：
  - 5 种道具、体力系统、基础经济（软币）、激励视频对接。
  - 关卡编辑器/配置加载，首批 30 关；基础埋点。
- 第 3 周：
  - 地图/章节、排行榜（开放数据域）、失败复活、A/B 框架。
  - 性能优化、适配低端机；首包与分包策略。
- 第 4 周（MVP）：
  - 扩充至 80–100 关；新手流程与引导；素材完善与打磨。
  - 小范围测试与修正，准备上线。
- 第 5–8 周：
  - 每周新增 30–50 关；活动系统（每日/限时），赛季通行证预研。
  - 变现与留存策略优化（价格、频次、转化漏斗）。

## 15. KPI 与监控
- 留存：D1/D3/D7、关卡漏斗（过关率/失败原因）。
- 变现：广告展示/完播率、IAP 转化、复活购买率、ARPU/ARPDAU。
- 体验：平均局时、局内步数、提示使用率、卡顿率、崩溃率。

## 16. 风险与对策
- 难度曲线失衡：建立设计规范（颜色数、障碍密度、步数建议），上线前 A/B。
- 低端机性能：对象池+动效降级+资源压缩；首包精简与延迟加载。
- 关卡供给不足：搭建关卡生产流程+编辑器+自动化校验（可解性脚本）。
- 审核/合规：广告节制、弱化诱导分享、敏感词审查、隐私合规。

——

附：核心模块拆解清单（技术）
- MatchFinder：扫描全局可消；支持 L/T、4 连、5 连识别。
- Resolver：按优先级结算（组合 > 特殊 > 普通），生成掉落事件序列。
- Spawner：按权重与禁手规则生成；确保首局可解。
- Shuffle：无解时触发洗牌，保留目标/障碍状态。
- RNG：种子随机，局内记录随机序列，支持回放。
- LevelLoader：JSON 读取、校验、版本兼容。
- BoosterSystem：道具库存、入场携带、局内消耗与结算。
- Economy/IAP/Ads：价格表、折扣、埋点、风控与频控。
- Analytics：关键事件上报、AB 框架、远程配置。
